# Name,   Type, SubType, Offset,  Size, Flags
# Note: if you have increased the bootloader size, make sure to update the offsets to avoid overlap
# 🔒 增强版分区表 - 添加加密标志

# NVS 分区 - 存储 WiFi、蓝牙等配置（加密）
nvs,      data, nvs,     0x9000,  0x6000,  encrypted

# PHY 初始化数据（不加密，RF 校准数据）
phy_init, data, phy,     0xf000,  0x1000

# 主应用分区（加密）
factory,  app,  factory, 0x10000, 1M,      encrypted

# 自定义数据分区 - FIDO 凭据存储（加密）
# 0x40 = Type: app, 0x1 = SubType: 用户自定义
fido_data, 0x40, 0x1,    0x200000, 1M,     encrypted

# OTA 分区（可选，如果需要支持固件更新）
# otadata,  data, ota,     0x310000, 0x2000,  encrypted
# ota_0,    app,  ota_0,   0x320000, 1M,      encrypted
# ota_1,    app,  ota_1,   0x420000, 1M,      encrypted

# ============================================================================
# 分区说明
# ============================================================================
#
# 1. NVS (Non-Volatile Storage)
#    - 大小: 24KB
#    - 用途: 系统配置、WiFi 凭据等
#    - 加密: 是（包含敏感配置）
#
# 2. PHY Init
#    - 大小: 4KB
#    - 用途: RF 校准数据
#    - 加密: 否（不含敏感信息，需要在启动早期访问）
#
# 3. Factory (主应用)
#    - 大小: 1MB
#    - 用途: FIDO2 固件
#    - 加密: 是（保护固件逻辑）
#    - 偏移: 0x10000 (bootloader 后)
#
# 4. FIDO Data
#    - 大小: 1MB
#    - 用途: Resident Keys, PIN, 配置
#    - 加密: 是（核心敏感数据）
#    - 地址: 0x200000 (2MB 处)
#
# ============================================================================
# Flash 布局 (4MB)
# ============================================================================
#
# 0x00000 - 0x08000  (32KB)  : Bootloader (二次引导加载程序)
# 0x08000 - 0x09000  (4KB)   : Partition Table (分区表)
# 0x09000 - 0x0F000  (24KB)  : NVS (加密)
# 0x0F000 - 0x10000  (4KB)   : PHY Init
# 0x10000 - 0x110000 (1MB)   : Factory App (加密)
# 0x110000 - 0x200000 (960KB): Reserved (未使用)
# 0x200000 - 0x300000 (1MB)  : FIDO Data (加密)
# 0x300000 - 0x400000 (1MB)  : Reserved (未来扩展)
#
# ============================================================================
# 加密说明
# ============================================================================
#
# 所有标记为 "encrypted" 的分区将：
# 1. 在首次启动时自动加密
# 2. 使用 AES-256-XTS 加密算法
# 3. 密钥存储在 eFuse 中（不可读取）
# 4. 运行时自动解密（透明）
#
# ⚠️ 重要：
# - 首次烧录后，Flash 加密会自动启用
# - 之后所有固件更新必须使用加密的镜像
# - 使用 esptool.py 加密固件：
#   esptool.py encrypt_flash_data --keyfile key.bin ...
#
# ============================================================================
# OTA 支持（可选）
# ============================================================================
#
# 如果需要支持 OTA 固件更新，取消注释 OTA 相关分区：
# - otadata: 2个 sector (8KB)，记录当前活动分区
# - ota_0: 1MB，第一个 OTA 分区
# - ota_1: 1MB，第二个 OTA 分区
#
# 启用 OTA 后的布局：
# 0x310000 - 0x312000 (8KB)   : OTA Data
# 0x320000 - 0x420000 (1MB)   : OTA_0 (加密)
# 0x420000 - 0x520000 (1MB)   : OTA_1 (加密)
#
# 注意：启用 OTA 需要修改 factory 分区大小或重新规划布局
#
# ============================================================================
# 生产建议
# ============================================================================
#
# 1. 确保所有敏感数据分区标记为 encrypted
# 2. 预留足够空间用于未来固件增长
# 3. 如果禁用串口下载模式，必须实现 OTA
# 4. 定期备份分区表和固件
# 5. 测试完整的加密 + 解密流程
#
# ============================================================================
